# AIアシスタント開発指針

## 1. プロジェクトの概要

このプロジェクトは、税務会計業務を効率化するためのWebアプリケーションです。主な目的は以下の通りです：

- 税務会計業務のデジタル化と効率化
- データの一元管理と正確性の向上
- 業務プロセスの標準化と透明性の確保
- レポート生成の自動化

## 2. このドキュメントの目的

このドキュメントは、AIアシスタント（以下、アシスタント）と開発者との効果的な協業を実現するために作成されています。主な目的は以下の通りです：

- アシスタントがプロジェクトの文脈を理解し、適切な支援を提供するための指針を確立する
- 開発者とアシスタントの間で一貫した開発方針と品質基準を共有する
- アシスタントの能力を最大限に活用し、開発効率を向上させる
- プロジェクトの品質と保守性を維持するための基準を明確にする

このドキュメントは、アシスタントがプロジェクトの開発を支援する際の基本的な指針として機能し、必要に応じて更新・改善されていきます。

### ファイル編集に関する注意事項

アシスタントは、このドキュメントを含むプロジェクト内のファイルを編集する際、以下の手順を必ず遵守します：

1. 編集内容を提案する前に、変更の概要を説明する
2. 編集の実行前に、必ず「(y/n)」の形式で意思確認を求める
3. ユーザーが「y」と回答した場合のみ、編集作業を実行する
4. ユーザーが「n」と回答した場合、または明確な承認がない場合は、編集を実行しない

この手順により、意図しない変更を防ぎ、開発者との意思疎通を確実にします。

## 3. 開発環境

このプロジェクトは以下の主要な技術スタックを使用しています：

### フロントエンド

- Next.js - Reactベースのフレームワーク
- Redux - 状態管理ライブラリ
  - アプリケーション全体の状態管理に使用
  - グローバルな状態の共有と管理を担当

### バックエンド

- PostgreSQL - リレーショナルデータベース
- Prisma - ORM（Object-Relational Mapping）
  - データベース操作の抽象化
  - 型安全なデータベースアクセスを提供
  - マイグレーション管理

## 4. ディレクトリ構成

プロジェクトの主要なディレクトリとその役割は以下の通りです：

### アプリケーションコード

- `app/` - Next.jsのアプリケーションコード
  - このディレクトリには、Next.jsのコア機能（APIルーティング、ページルーティング）のみを配置します
  - ビジネスロジックは `lib/` ディレクトリに配置し、`app/` からはそれらを呼び出す形にします
  - これにより、ビジネスロジックの再利用性と保守性を高めます
  - ページ専用のコンポーネントは、各ページディレクトリ内の `components/` ディレクトリに配置します
    - 例：`app/dashboard/components/` にはダッシュボードページ専用のコンポーネントを配置
    - これにより、ページ固有のコンポーネントの管理が容易になります
- `components/` - 再利用可能なReactコンポーネント
- `lib/` - ユーティリティ関数や共通ロジック
  - `redux/` - Reduxのストア、アクション、リデューサーを管理
  - `services/` - APIエンドポイントから呼び出されるビジネスロジックを配置
  - `client/` - フロントエンド用の型定義とユーティリティ関数
- `hooks/` - カスタムReactフック
- `styles/` - グローバルスタイル定義
- `public/` - 静的ファイル（画像など）

### データベース関連

- `migrations/` - データベースマイグレーションファイル
- `schema.prisma` - Prismaスキーマ定義

### テスト関連

- `__tests__/` - テストファイル
- `seed/` - テスト用シードデータ

### ドキュメント

- `docs/` - プロジェクトドキュメント

### その他

- `bin/` - データベースバックアップやユーザー登録などの管理用ツール

この構成は、機能ごとに明確に分離されており、コードの保守性と可読性を高めています。アシスタントは、この構成を理解し、適切なディレクトリにコードを配置することを心がけます。

### 新しいAPIの実装手順

1. サービス層での実装

   - `lib/services/` にビジネスロジックを実装
   - 型定義とバリデーションを含める

2. APIエンドポイントの実装

   - `app/api/` にエンドポイントを実装
   - サービス層の関数を呼び出す

3. Reduxの設定

   - ステートにAPIレスポンス用の型と初期値を定義
   - 非同期アクションを実装

4. ページコンポーネントでの利用
   - 非同期アクションを呼び出し
   - ステートの変更を監視

## 5. コーディング規約

### インポート規則

- import文では、`../xxx` のような相対パスは使用せず、必ずエイリアス（例：`@/lib/xxx`）を利用してください。
  - 理由：可読性・保守性の向上、リファクタリング時の安全性確保のため

### AIによる編集時の注意事項

- ファイル編集時は、フォーマッタの挙動を考慮して以下の点に注意してください：
  1. 未使用のimport文は、フォーマッタによって自動的に削除される可能性があります
  2. 一時的に未使用となるimport文は、コメントアウトして保持してください
  3. 複数のimport文を追加・修正する場合は、一度に全ての変更を適用してください
  4. 必要に応じて、`// @ts-ignore` や `// eslint-disable-next-line` などのコメントを使用して、一時的な警告を抑制してください
